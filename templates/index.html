{% extends "base.html" %}

{% block title %}Mapa de Salas - SENAI Morvan Figueiredo{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1><i class="fas fa-map me-2 text-primary"></i>Mapa de Salas</h1>
                <div class="btn-group" role="group">
                    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-primary">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                    {% if session.admin_authenticated %}
                    <a href="{{ url_for('generate_general_report_route') }}" class="btn btn-outline-success">
                        <i class="fas fa-file-pdf me-2"></i>Relatório Geral
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Filtros</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">Bloco</label>
                            <select class="form-select" id="filterBlock">
                                <option value="">Todos os blocos</option>
                                <option value="A">Bloco A</option>
                                <option value="B">Bloco B</option>
                                <option value="C">Bloco C</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Andar</label>
                            <select class="form-select" id="filterFloor">
                                <option value="">Todos os andares</option>
                                <option value="1">1º Andar</option>
                                <option value="2">2º Andar</option>
                                <option value="3">3º Andar</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Computadores</label>
                            <select class="form-select" id="filterComputers">
                                <option value="">Todos</option>
                                <option value="true">Com computadores</option>
                                <option value="false">Sem computadores</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Capacidade</label>
                            <select class="form-select" id="filterCapacity">
                                <option value="">Qualquer capacidade</option>
                                <option value="small">Até 20 alunos</option>
                                <option value="medium">21-30 alunos</option>
                                <option value="large">Mais de 30 alunos</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Classrooms Grid -->
    <div class="row" id="classroomsGrid">
        {% for classroom in classrooms %}
        <div class="col-lg-4 col-md-6 mb-4 classroom-card" 
             data-block="{{ classroom.block }}" 
             data-floor="{{ classroom.floor }}" 
             data-computers="{{ classroom.has_computers|lower }}"
             data-capacity="{{ classroom.capacity }}">
            <div class="card h-100 clean-card">
                {% if classroom.image_url %}
                <img src="{{ classroom.image_url }}" class="classroom-image" alt="{{ classroom.name }}">
                {% else %}
                <div class="classroom-image-placeholder">
                    <i class="fas fa-door-open"></i>
                </div>
                {% endif %}
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h5 class="card-title mb-1">{{ classroom.name }}</h5>
                            <small class="text-muted">{{ classroom.block }}{{ classroom.floor }} • {{ classroom.capacity }} alunos</small>
                        </div>
                        {% if classroom.has_computers %}
                        <i class="fas fa-desktop text-success" title="Com computadores"></i>
                        {% endif %}
                    </div>
                    
                    {% if classroom.software %}
                    <div class="mb-2">
                        <div class="text-truncate small text-muted">{{ classroom.software }}</div>
                    </div>
                    {% endif %}
                    
                    <div class="d-flex justify-content-between align-items-center mt-auto">
                        <a href="{{ url_for('classroom_detail', classroom_id=classroom.id) }}" class="btn btn-sm btn-primary">
                            <i class="fas fa-eye me-1"></i>Ver
                        </a>
                        <div class="btn-group btn-group-sm">
                            <a href="{{ url_for('generate_pdf', classroom_id=classroom.id) }}" class="btn btn-outline-secondary btn-sm" title="PDF">
                                <i class="fas fa-file-pdf"></i>
                            </a>
                            <a href="{{ url_for('generate_qr', classroom_id=classroom.id) }}" class="btn btn-outline-secondary btn-sm" title="QR Code">
                                <i class="fas fa-qrcode"></i>
                            </a>
                            {% if session.admin_authenticated %}
                            <a href="{{ url_for('edit_classroom', classroom_id=classroom.id) }}" class="btn btn-outline-warning btn-sm" title="Editar">
                                <i class="fas fa-edit"></i>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if not classrooms %}
    <div class="row">
        <div class="col-12">
            <div class="text-center py-5">
                <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                <h3>Nenhuma sala cadastrada</h3>
                <p class="text-muted">Não há salas cadastradas no sistema.</p>
                {% if session.admin_authenticated %}
                <a href="{{ url_for('add_classroom') }}" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Cadastrar Nova Sala
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
// Filter functionality
function filterClassrooms() {
    const filterBlock = document.getElementById('filterBlock').value;
    const filterFloor = document.getElementById('filterFloor').value;
    const filterComputers = document.getElementById('filterComputers').value;
    const filterCapacity = document.getElementById('filterCapacity').value;
    
    const cards = document.querySelectorAll('.classroom-card');
    
    cards.forEach(card => {
        let show = true;
        
        // Block filter
        if (filterBlock && card.dataset.block !== filterBlock) {
            show = false;
        }
        
        // Floor filter
        if (filterFloor && card.dataset.floor !== filterFloor) {
            show = false;
        }
        
        // Computers filter
        if (filterComputers && card.dataset.computers !== filterComputers) {
            show = false;
        }
        
        // Capacity filter
        if (filterCapacity) {
            const capacity = parseInt(card.dataset.capacity);
            if (filterCapacity === 'small' && capacity > 20) show = false;
            if (filterCapacity === 'medium' && (capacity <= 20 || capacity > 30)) show = false;
            if (filterCapacity === 'large' && capacity <= 30) show = false;
        }
        
        card.style.display = show ? 'block' : 'none';
    });
}

// Add event listeners to filters
document.getElementById('filterBlock').addEventListener('change', filterClassrooms);
document.getElementById('filterFloor').addEventListener('change', filterClassrooms);
document.getElementById('filterComputers').addEventListener('change', filterClassrooms);
document.getElementById('filterCapacity').addEventListener('change', filterClassrooms);
</script>
{% endblock %}
